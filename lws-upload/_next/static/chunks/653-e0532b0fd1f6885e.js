"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[653],{10:(e,s,a)=>{a.d(s,{$v:()=>p,EO:()=>m,Lt:()=>c,Rx:()=>f,Zr:()=>j,ck:()=>x,r7:()=>h,wd:()=>u});var t=a(5155),l=a(2115),r=a(7649),i=a(9434),n=a(285);let c=r.bL;r.l9;let d=r.ZL,o=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(r.hJ,{className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...l,ref:s})});o.displayName=r.hJ.displayName;let m=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsxs)(d,{children:[(0,t.jsx)(o,{}),(0,t.jsx)(r.UC,{ref:s,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...l})]})});m.displayName=r.UC.displayName;let u=e=>{let{className:s,...a}=e;return(0,t.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",s),...a})};u.displayName="AlertDialogHeader";let x=e=>{let{className:s,...a}=e;return(0,t.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a})};x.displayName="AlertDialogFooter";let h=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(r.hE,{ref:s,className:(0,i.cn)("text-lg font-semibold",a),...l})});h.displayName=r.hE.displayName;let p=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(r.VY,{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",a),...l})});p.displayName=r.VY.displayName;let f=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(r.rc,{ref:s,className:(0,i.cn)((0,n.r)(),a),...l})});f.displayName=r.rc.displayName;let j=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(r.ZD,{ref:s,className:(0,i.cn)((0,n.r)({variant:"outline"}),"mt-2 sm:mt-0",a),...l})});j.displayName=r.ZD.displayName},93:(e,s,a)=>{a.d(s,{P:()=>k});var t=a(5155),l=a(2115),r=a(4165),i=a(285),n=a(6126),c=a(4944),d=a(5365),o=a(7434),m=a(7213),u=a(9803),x=a(227),h=a(9022),p=a(4261),f=a(5339),j=a(1788),g=a(4416),v=a(6262),N=a(4481),b=a(2568),w=a(1981);let y=e=>e?e.startsWith("image/")?(0,t.jsx)(m.A,{className:"h-8 w-8 text-blue-500"}):e.startsWith("video/")?(0,t.jsx)(u.A,{className:"h-8 w-8 text-purple-500"}):e.startsWith("audio/")?(0,t.jsx)(x.A,{className:"h-8 w-8 text-green-500"}):e.includes("zip")||e.includes("rar")?(0,t.jsx)(h.A,{className:"h-8 w-8 text-orange-500"}):e.includes("sheet")||e.includes("excel")?(0,t.jsx)(p.A,{className:"h-8 w-8 text-green-600"}):(0,t.jsx)(o.A,{className:"h-8 w-8 text-gray-500"}):(0,t.jsx)(o.A,{className:"h-8 w-8 text-gray-500"}),A=e=>!!e&&(e.startsWith("image/")||"application/pdf"===e||e.startsWith("text/")||e.startsWith("video/")||e.startsWith("audio/")||"application/vnd.ms-excel"===e||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e||"application/msword"===e||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===e);function k(e){var s,a,m,u,h,k,C,E,z,S,P;let{document:T,isOpen:V,onClose:I}=e,[F,L]=(0,l.useState)(100),[R,O]=(0,l.useState)(0),[D,$]=(0,l.useState)(!1),[_,M]=(0,l.useState)(!1),[B,U]=(0,l.useState)(!0),[W,q]=(0,l.useState)(null),[J,Z]=(0,l.useState)(null),G=(P=null==(s=T.currentVersion)?void 0:s.fileType)?P.startsWith("image/")?"image":"application/pdf"===P?"pdf":P.startsWith("text/")?"text":P.startsWith("video/")?"video":P.startsWith("audio/")?"audio":P.includes("sheet")||P.includes("excel")||P.includes("word")||P.includes("document")?"office":"unsupported":"unsupported";(0,l.useEffect)(()=>(V&&T.id&&H(),()=>{J&&URL.revokeObjectURL(J)}),[V,T.id]);let H=async()=>{U(!0),q(null);try{let e=await fetch("/api/documents/".concat(T.id,"/download"));if(e.ok){let s=await e.blob(),a=URL.createObjectURL(s);Z(a)}else q("Erreur lors du chargement du document")}catch(e){q("Erreur de connexion")}finally{U(!1)}},X=async()=>{try{if(J){var e;let s=T.createElement("a");s.style.display="none",s.href=J,s.download=(null==(e=T.currentVersion)?void 0:e.fileName)||"document",T.body.appendChild(s),s.click(),T.body.removeChild(s)}}catch(e){console.error("Erreur t\xe9l\xe9chargement:",e)}};return(0,t.jsx)(r.lG,{open:V,onOpenChange:I,children:(0,t.jsxs)(r.Cf,{showCloseButton:!1,className:"w-full max-w-7xl mx-auto transition-all duration-300 ".concat(D?"max-h-[98vh] w-[98vw]":"max-h-[92vh]"," overflow-hidden flex flex-col"),children:[(0,t.jsx)(r.c7,{className:"flex-shrink-0 pb-2",children:(0,t.jsxs)(r.L3,{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[y(null==(a=T.currentVersion)?void 0:a.fileType),(0,t.jsx)("span",{className:"truncate text-base sm:text-lg",children:T.title})]}),(0,t.jsxs)(i.$,{variant:"ghost",size:"sm",onClick:I,className:"flex-shrink-0 ml-2",children:[(0,t.jsx)(g.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Fermer"})]})]})}),(0,t.jsxs)("div",{className:"flex-1 overflow-hidden flex flex-col space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 text-sm p-3 sm:p-4 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("strong",{className:"block",children:"Fichier:"}),(0,t.jsx)("p",{className:"text-muted-foreground truncate",children:null==(m=T.currentVersion)?void 0:m.fileName})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{className:"block",children:"Taille:"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:(null==(u=T.currentVersion)?void 0:u.fileSize)?(e=>{if(0===e)return"0 Bytes";let s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]})(T.currentVersion.fileSize):"N/A"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{className:"block",children:"Type:"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:null==(C=T.currentVersion)||null==(k=C.fileType)||null==(h=k.split("/")[1])?void 0:h.toUpperCase()})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{className:"block",children:"Version:"}),(0,t.jsxs)("p",{className:"text-muted-foreground",children:["v",null==(E=T.currentVersion)?void 0:E.versionNumber]})]})]}),A(null==(z=T.currentVersion)?void 0:z.fileType)&&(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3 p-3 bg-gray-100 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:["image"===G&&(0,t.jsxs)("div",{className:"flex items-center gap-1 border rounded-md bg-white px-2",children:[(0,t.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>L(e=>Math.max(e-25,25)),disabled:F<=25,className:"p-1",children:(0,t.jsx)(v.A,{className:"h-4 w-4"})}),(0,t.jsxs)("span",{className:"text-sm font-medium min-w-12 text-center",children:[F,"%"]}),(0,t.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>L(e=>Math.min(e+25,300)),disabled:F>=300,className:"p-1",children:(0,t.jsx)(N.A,{className:"h-4 w-4"})}),(0,t.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>O(e=>(e+90)%360),className:"p-1",children:(0,t.jsx)(b.A,{className:"h-4 w-4"})})]}),(0,t.jsx)(n.E,{variant:T.isPublic?"default":"secondary",className:"flex-shrink-0",children:T.isPublic?"Public":"Priv\xe9"}),(null==(S=T._count)?void 0:S.versions)&&(0,t.jsxs)(n.E,{variant:"outline",className:"flex-shrink-0",children:[T._count.versions," version(s)"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>$(!D),className:"flex-shrink-0",children:[(0,t.jsx)(w.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline ml-1",children:D?"R\xe9duire":"Plein \xe9cran"})]}),(0,t.jsxs)(i.$,{onClick:X,size:"sm",className:"flex-shrink-0",children:[(0,t.jsx)(j.A,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"hidden sm:inline ml-2",children:"T\xe9l\xe9charger"})]})]})]}),(0,t.jsx)("div",{className:"flex-1 border rounded-lg overflow-hidden",children:(()=>{var e,s,a,l,r,n;if(B)return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[(0,t.jsx)(c.k,{value:void 0,className:"w-48"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Chargement de la pr\xe9visualisation..."})]});if(W)return(0,t.jsxs)(d.Fc,{variant:"destructive",children:[(0,t.jsx)(f.A,{className:"h-4 w-4"}),(0,t.jsx)(d.TN,{children:W})]});if(!J||!A(null==(e=T.currentVersion)?void 0:e.fileType))return(0,t.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,t.jsx)("div",{className:"mb-4",children:y(null==(s=T.currentVersion)?void 0:s.fileType)}),(0,t.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Aper\xe7u non disponible"}),(0,t.jsx)("p",{className:"text-sm mb-4",children:"Ce type de fichier ne peut pas \xeatre pr\xe9visualis\xe9 dans le navigateur. Vous pouvez le t\xe9l\xe9charger pour l'ouvrir avec l'application appropri\xe9e."}),(0,t.jsxs)(i.$,{onClick:X,variant:"outline",children:[(0,t.jsx)(j.A,{className:"w-4 h-4 mr-2"}),"T\xe9l\xe9charger pour ouvrir"]})]});switch(G){case"image":return(0,t.jsx)("div",{className:"relative bg-gray-50 min-h-96 flex items-center justify-center overflow-hidden",children:(0,t.jsx)("img",{src:J,alt:(null==(a=T.currentVersion)?void 0:a.fileName)||"Image",className:"max-w-full max-h-96 transition-transform duration-200",style:{transform:"scale(".concat(F/100,") rotate(").concat(R,"deg)"),transformOrigin:"center"},onError:()=>q("Impossible de charger l'image")})});case"pdf":return(0,t.jsx)("div",{className:"bg-gray-50",style:{height:D?"70vh":"500px"},children:(0,t.jsx)("iframe",{src:J,className:"w-full h-full border-0",title:(null==(l=T.currentVersion)?void 0:l.fileName)||"PDF",onError:()=>q("Impossible de charger le PDF")})});case"video":return(0,t.jsx)("div",{className:"bg-black flex items-center justify-center",style:{height:D?"60vh":"400px"},children:(0,t.jsx)("video",{src:J,controls:!0,className:"max-w-full max-h-full",onPlay:()=>M(!0),onPause:()=>M(!1),onError:()=>q("Impossible de lire la vid\xe9o"),children:"Votre navigateur ne supporte pas la lecture vid\xe9o."})});case"audio":return(0,t.jsxs)("div",{className:"p-8 text-center bg-gray-50",children:[(0,t.jsx)(x.A,{className:"mx-auto h-16 w-16 mb-4 text-green-500"}),(0,t.jsx)("h3",{className:"text-lg font-medium mb-4",children:null==(r=T.currentVersion)?void 0:r.fileName}),(0,t.jsx)("audio",{src:J,controls:!0,className:"mx-auto",onPlay:()=>M(!0),onPause:()=>M(!1),onError:()=>q("Impossible de lire l'audio"),children:"Votre navigateur ne supporte pas la lecture audio."})]});case"text":return(0,t.jsx)("div",{className:"bg-white p-4 overflow-auto",style:{maxHeight:"500px"},children:(0,t.jsx)("iframe",{src:J,className:"w-full border-0 min-h-96",title:(null==(n=T.currentVersion)?void 0:n.fileName)||"Texte",onError:()=>q("Impossible de charger le fichier texte")})});case"office":return(0,t.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,t.jsx)(p.A,{className:"mx-auto h-16 w-16 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Document Office"}),(0,t.jsx)("p",{className:"text-sm mb-4",children:"Les documents Office n\xe9cessitent une application d\xe9di\xe9e pour \xeatre visualis\xe9s."}),(0,t.jsxs)(i.$,{onClick:X,variant:"outline",children:[(0,t.jsx)(j.A,{className:"w-4 h-4 mr-2"}),"T\xe9l\xe9charger pour ouvrir"]})]});default:return(0,t.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,t.jsx)(o.A,{className:"mx-auto h-16 w-16 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Format non support\xe9"}),(0,t.jsx)("p",{className:"text-sm",children:"T\xe9l\xe9chargez le fichier pour l'ouvrir."})]})}})()})]})]})})}},2094:(e,s,a)=>{a.d(s,{W:()=>N});var t=a(5155),l=a(2115),r=a(6695),i=a(285),n=a(6126),c=a(8856),d=a(4165),o=a(10),m=a(9434),u=a(9676),x=a(1497),h=a(7434),p=a(1788),f=a(133),j=a(1007),g=a(4186),v=a(5339);function N(e){let{documentId:s,documentTitle:a,trigger:N}=e,[b,w]=(0,l.useState)([]),[y,A]=(0,l.useState)(""),[k,C]=(0,l.useState)(!1),[E,z]=(0,l.useState)(null),[S,P]=(0,l.useState)(null),[T,V]=(0,l.useState)(!1),[I,F]=(0,l.useState)(null),[L,R]=(0,l.useState)(null),O=async()=>{try{C(!0),z(null);let e=await fetch("/api/documents/versions?documentId=".concat(s));if(!e.ok)throw Error("Erreur lors de la r\xe9cup\xe9ration des versions");let a=await e.json();w(a.versions),A(a.currentVersionId)}catch(e){console.error("Erreur versions:",e),z(e instanceof Error?e.message:"Erreur inconnue")}finally{C(!1)}};(0,l.useEffect)(()=>{T&&s&&O()},[T,s]);let D=async(e,s)=>{try{F(e),z(null),P(null);let a=await fetch("/api/documents/versions/".concat(e,"/restore"),{method:"POST"}),t=await a.json();if(!a.ok)throw Error(t.error||"Erreur lors de la restauration");await O(),P("Version ".concat(s," restaur\xe9e avec succ\xe8s !")),R(null),setTimeout(()=>P(null),5e3)}catch(e){console.error("Erreur restauration:",e),z(e instanceof Error?e.message:"Erreur lors de la restauration"),R(null)}finally{F(null)}},$=async(e,s)=>{try{z(null);let a=await fetch("/api/documents/versions/".concat(e,"/download"));if(!a.ok){let e=await a.json();throw Error(e.error||"Erreur lors du t\xe9l\xe9chargement")}let t=await a.blob(),l=window.URL.createObjectURL(t),r=document.createElement("a");r.style.display="none",r.href=l,r.download=s,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(l),document.body.removeChild(r)}catch(e){console.error("Erreur t\xe9l\xe9chargement:",e),z(e instanceof Error?e.message:"Erreur lors du t\xe9l\xe9chargement")}},_=(0,t.jsxs)(i.$,{variant:"outline",size:"sm",children:[(0,t.jsx)(u.A,{className:"mr-2 h-4 w-4"}),"Historique"]});return(0,t.jsxs)(d.lG,{open:T,onOpenChange:V,children:[(0,t.jsx)(d.zM,{asChild:!0,children:N||_}),(0,t.jsxs)(d.Cf,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[(0,t.jsxs)(d.c7,{children:[(0,t.jsxs)(d.L3,{className:"flex items-center space-x-2",children:[(0,t.jsx)(u.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Historique des versions"})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:a})]}),(0,t.jsx)("div",{className:"space-y-4",children:k?Array.from({length:3}).map((e,s)=>(0,t.jsx)(r.Zp,{children:(0,t.jsx)(r.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.E,{className:"h-4 w-32"}),(0,t.jsx)(c.E,{className:"h-3 w-48"}),(0,t.jsx)(c.E,{className:"h-3 w-24"})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(c.E,{className:"h-8 w-20"}),(0,t.jsx)(c.E,{className:"h-8 w-20"})]})]})})},s)):E?(0,t.jsx)(r.Zp,{className:"border-red-200 bg-red-50",children:(0,t.jsx)(r.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-red-600",children:[(0,t.jsx)(x.A,{className:"h-4 w-4"}),(0,t.jsx)("p",{className:"text-sm",children:E})]})})}):0===b.length?(0,t.jsx)(r.Zp,{children:(0,t.jsx)(r.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(u.A,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,t.jsx)("h3",{className:"mt-2 text-sm font-medium text-muted-foreground",children:"Aucune version trouv\xe9e"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Ce document n'a pas d'historique de versions."})]})})}):b.map(e=>(0,t.jsxs)(r.Zp,{className:e.isCurrent?"border-green-200 bg-green-50":"",children:[(0,t.jsx)(r.aR,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)(r.ZB,{className:"text-base",children:["Version ",e.versionNumber]}),e.isCurrent&&(0,t.jsx)(n.E,{variant:"default",className:"bg-green-600",children:"Actuelle"})]}),(0,t.jsxs)(r.BT,{className:"flex items-center space-x-4",children:[(0,t.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,t.jsx)(h.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{children:e.fileName})]}),(0,t.jsx)("span",{children:(0,m.v7)(e.fileSize)})]})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>$(e.id,e.fileName),children:[(0,t.jsx)(p.A,{className:"mr-1 h-3 w-3"}),"T\xe9l\xe9charger"]}),!e.isCurrent&&(0,t.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>{R({versionId:e.id,versionNumber:e.versionNumber})},disabled:I===e.id,children:[(0,t.jsx)(f.A,{className:"mr-1 h-3 w-3"}),I===e.id?"Restauration...":"Restaurer"]})]})]})}),(0,t.jsx)(r.Wu,{children:(0,t.jsxs)("div",{className:"space-y-2 text-sm text-muted-foreground",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(j.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{children:e.createdBy.name||e.createdBy.email})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(g.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{children:(0,m.fw)(e.createdAt)})]}),e.changeLog&&(0,t.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,t.jsx)(x.A,{className:"h-3 w-3 mt-0.5"}),(0,t.jsx)("span",{className:"flex-1",children:e.changeLog})]})]})})]},e.id))})]}),(0,t.jsx)(o.Lt,{open:!!L,onOpenChange:()=>R(null),children:(0,t.jsxs)(o.EO,{children:[(0,t.jsxs)(o.wd,{children:[(0,t.jsxs)(o.r7,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-5 w-5 text-orange-500"}),"Confirmer la restauration"]}),(0,t.jsxs)(o.$v,{className:"space-y-2",children:[(0,t.jsxs)("p",{children:["\xcates-vous s\xfbr de vouloir restaurer la ",(0,t.jsxs)("strong",{children:["version ",null==L?void 0:L.versionNumber]})," de ce document ?"]}),(0,t.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(v.A,{className:"h-4 w-4 text-yellow-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"text-sm text-yellow-800",children:[(0,t.jsx)("p",{className:"font-medium mb-1",children:"Points importants :"}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,t.jsx)("li",{children:"Cette action changera la version actuelle du document"}),(0,t.jsx)("li",{children:"La version actuelle sera conserv\xe9e dans l'historique"}),(0,t.jsx)("li",{children:"Tous les utilisateurs verront la version restaur\xe9e"}),(0,t.jsx)("li",{children:"Cette action est r\xe9versible"})]})]})]})})]})]}),(0,t.jsxs)(o.ck,{children:[(0,t.jsx)(o.Zr,{children:"Annuler"}),(0,t.jsx)(o.Rx,{onClick:()=>L&&D(L.versionId,L.versionNumber),className:"bg-orange-600 hover:bg-orange-700",disabled:!!I,children:I?"Restauration en cours...":"Confirmer la restauration"})]})]})})]})}},2392:(e,s,a)=>{a.d(s,{a:()=>E});var t=a(5155),l=a(2115),r=a(4165),i=a(285),n=a(2523),c=a(5057),d=a(6126),o=a(5365),m=a(2346),u=a(9409),x=a(5127),h=a(2657),p=a(3717),f=a(7951),j=a(6516),g=a(4869),v=a(2919),N=a(5339),b=a(5196),w=a(2318),y=a(1007),A=a(5525),k=a(2525);let C=[{value:"READ",label:"Lecture",icon:h.A,color:"bg-blue-100 text-blue-800"},{value:"WRITE",label:"\xc9criture",icon:p.A,color:"bg-green-100 text-green-800"},{value:"ADMIN",label:"Administration",icon:f.A,color:"bg-purple-100 text-purple-800"}];function E(e){var s;let{document:a,isOpen:E,onClose:z,onShared:S}=e,[P,T]=(0,l.useState)([]),[V,I]=(0,l.useState)(!1),[F,L]=(0,l.useState)(""),[R,O]=(0,l.useState)(""),[D,$]=(0,l.useState)(""),[_,M]=(0,l.useState)("READ"),[B,U]=(0,l.useState)(!1),[W,q]=(0,l.useState)([]),[J,Z]=(0,l.useState)(!1);(0,l.useEffect)(()=>{E&&G()},[E,a.id]);let G=async()=>{I(!0),L("");try{let e=await fetch("/api/documents/".concat(a.id,"/share"));if(e.ok){let s=await e.json();T(s.shares||[])}else L("Erreur lors du chargement des partages")}catch(e){L("Erreur de connexion")}finally{I(!1)}},H=async e=>{if(e.preventDefault(),D.trim()){U(!0),L(""),O("");try{let e=await fetch("/api/documents/".concat(a.id,"/share"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userEmail:D.trim(),permission:_.toUpperCase()})});if(e.ok)await e.json(),O("Document partag\xe9 avec succ\xe8s !"),$(""),M("READ"),await G(),null==S||S();else{let s=await e.json();L(s.error||"Erreur lors du partage")}}catch(e){L("Erreur de connexion")}finally{U(!1)}}},X=async e=>{try{(await fetch("/api/documents/".concat(a.id,"/share?shareId=").concat(e),{method:"DELETE"})).ok?(O("Partage supprim\xe9 avec succ\xe8s"),await G(),null==S||S()):L("Erreur lors de la suppression du partage")}catch(e){L("Erreur de connexion")}},Y=async e=>{if(e.length<2){q([]),Z(!1);return}try{let s=await fetch("/api/users/search?q=".concat(encodeURIComponent(e),"&limit=5"));if(s.ok){let e=await s.json();q(e.users||[]),Z(!0)}}catch(e){console.error("Erreur recherche utilisateurs:",e)}},K=e=>C.find(s=>s.value===e)||C[0],Q=e=>new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return(0,t.jsx)(r.lG,{open:E,onOpenChange:z,children:(0,t.jsxs)(r.Cf,{className:"w-full max-w-4xl mx-auto max-h-[95vh] overflow-y-auto",children:[(0,t.jsx)(r.c7,{children:(0,t.jsxs)(r.L3,{className:"flex items-center gap-2 text-base sm:text-lg",children:[(0,t.jsx)(j.A,{className:"h-5 w-5 flex-shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:"Partager le document"})]})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"p-3 sm:p-4 bg-gray-50 rounded-lg",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("h3",{className:"font-medium truncate",children:a.title}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Propri\xe9taire : ",(null==(s=a.author)?void 0:s.name)||"Inconnu"]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2 flex-shrink-0",children:a.isPublic?(0,t.jsxs)(d.E,{variant:"outline",className:"gap-1",children:[(0,t.jsx)(g.A,{className:"h-3 w-3"}),"Public"]}):(0,t.jsxs)(d.E,{variant:"secondary",className:"gap-1",children:[(0,t.jsx)(v.A,{className:"h-3 w-3"}),"Priv\xe9"]})})]})}),F&&(0,t.jsxs)(o.Fc,{variant:"destructive",children:[(0,t.jsx)(N.A,{className:"h-4 w-4"}),(0,t.jsx)(o.TN,{children:F})]}),R&&(0,t.jsxs)(o.Fc,{children:[(0,t.jsx)(b.A,{className:"h-4 w-4"}),(0,t.jsx)(o.TN,{children:R})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h4",{className:"font-medium flex items-center gap-2",children:[(0,t.jsx)(w.A,{className:"h-4 w-4"}),"Partager avec un nouvel utilisateur"]}),(0,t.jsxs)("form",{onSubmit:H,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col lg:grid lg:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 relative",children:[(0,t.jsx)(c.J,{htmlFor:"email",children:"Email de l'utilisateur"}),(0,t.jsx)(n.p,{id:"email",type:"email",placeholder:"exemple@email.com ou nom d'utilisateur",value:D,onChange:e=>{var s;$(s=e.target.value),Y(s)},onBlur:()=>setTimeout(()=>Z(!1),200),onFocus:()=>W.length>0&&Z(!0),required:!0,className:"w-full"}),J&&W.length>0&&(0,t.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-40 overflow-y-auto",children:W.map(e=>(0,t.jsxs)("button",{type:"button",className:"w-full px-3 py-2 text-left hover:bg-gray-50 flex items-center gap-2",onClick:()=>{$(e.email),Z(!1)},children:[(0,t.jsx)(y.A,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"font-medium text-sm truncate",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-gray-500 truncate",children:e.email})]})]},e.id))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.J,{htmlFor:"permission",children:"Permission"}),(0,t.jsxs)(u.l6,{value:_,onValueChange:e=>M(e),children:[(0,t.jsx)(u.bq,{className:"w-full",children:(0,t.jsx)(u.yv,{})}),(0,t.jsx)(u.gC,{children:C.map(e=>(0,t.jsx)(u.eb,{value:e.value,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(e.icon,{className:"h-4 w-4"}),e.label]})},e.value))})]})]})]}),(0,t.jsx)(i.$,{type:"submit",disabled:B||!D.trim(),className:"w-full sm:w-auto",children:B?"Partage en cours...":"Partager"})]})]}),(0,t.jsx)(m.w,{}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h4",{className:"font-medium flex items-center gap-2",children:[(0,t.jsx)(A.A,{className:"h-4 w-4"}),"Utilisateurs ayant acc\xe8s (",P.length,")"]}),V?(0,t.jsx)("div",{className:"text-center py-4",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Chargement..."})}):P.length>0?(0,t.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,t.jsx)("div",{className:"hidden md:block",children:(0,t.jsxs)(x.XI,{children:[(0,t.jsx)(x.A0,{children:(0,t.jsxs)(x.Hj,{children:[(0,t.jsx)(x.nd,{children:"Utilisateur"}),(0,t.jsx)(x.nd,{children:"Permission"}),(0,t.jsx)(x.nd,{children:"Partag\xe9 le"}),(0,t.jsx)(x.nd,{className:"w-12",children:"Actions"})]})}),(0,t.jsx)(x.BF,{children:P.map(e=>{let s=K(e.permission);return(0,t.jsxs)(x.Hj,{children:[(0,t.jsx)(x.nA,{children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center flex-shrink-0",children:(0,t.jsx)(y.A,{className:"h-4 w-4 text-gray-600"})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"font-medium truncate",children:e.user.name}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:e.user.email})]})]})}),(0,t.jsx)(x.nA,{children:(0,t.jsxs)(d.E,{className:s.color,children:[(0,t.jsx)(s.icon,{className:"h-3 w-3 mr-1"}),s.label]})}),(0,t.jsx)(x.nA,{children:(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:Q(e.createdAt)})}),(0,t.jsx)(x.nA,{children:(0,t.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>X(e.id),className:"text-red-600 hover:text-red-700",children:(0,t.jsx)(k.A,{className:"h-4 w-4"})})})]},e.id)})})]})}),(0,t.jsx)("div",{className:"md:hidden space-y-3 p-4",children:P.map(e=>{let s=K(e.permission);return(0,t.jsxs)("div",{className:"border rounded-lg p-3 bg-white",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center flex-shrink-0",children:(0,t.jsx)(y.A,{className:"h-4 w-4 text-gray-600"})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"font-medium text-sm truncate",children:e.user.name}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:e.user.email})]})]}),(0,t.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>X(e.id),className:"text-red-600 hover:text-red-700 flex-shrink-0",children:(0,t.jsx)(k.A,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-3 border-t",children:[(0,t.jsxs)(d.E,{className:s.color,children:[(0,t.jsx)(s.icon,{className:"h-3 w-3 mr-1"}),s.label]}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:Q(e.createdAt)})]})]},e.id)})})]}):(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(j.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{children:"Aucun partage pour ce document"}),(0,t.jsx)("p",{className:"text-sm",children:"Ajoutez des utilisateurs ci-dessus pour commencer \xe0 partager"})]})]}),(0,t.jsxs)("div",{className:"bg-blue-50 p-3 sm:p-4 rounded-lg",children:[(0,t.jsx)("h5",{className:"font-medium mb-3",children:"Niveaux de permission"}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(h.A,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Lecture :"})," Peut voir et t\xe9l\xe9charger le document"]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(p.A,{className:"h-4 w-4 text-green-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"\xc9criture :"})," Peut modifier les m\xe9tadonn\xe9es et ajouter des versions"]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(f.A,{className:"h-4 w-4 text-purple-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Administration :"})," Peut g\xe9rer les partages et supprimer le document"]})]})]})]})]})]})})}},4165:(e,s,a)=>{a.d(s,{Cf:()=>m,Es:()=>x,L3:()=>h,c7:()=>u,lG:()=>n,rr:()=>p,zM:()=>c});var t=a(5155);a(2115);var l=a(5452),r=a(4416),i=a(9434);function n(e){let{...s}=e;return(0,t.jsx)(l.bL,{"data-slot":"dialog",...s})}function c(e){let{...s}=e;return(0,t.jsx)(l.l9,{"data-slot":"dialog-trigger",...s})}function d(e){let{...s}=e;return(0,t.jsx)(l.ZL,{"data-slot":"dialog-portal",...s})}function o(e){let{className:s,...a}=e;return(0,t.jsx)(l.hJ,{"data-slot":"dialog-overlay",className:(0,i.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...a})}function m(e){let{className:s,children:a,showCloseButton:n=!0,...c}=e;return(0,t.jsxs)(d,{"data-slot":"dialog-portal",children:[(0,t.jsx)(o,{}),(0,t.jsxs)(l.UC,{"data-slot":"dialog-content",className:(0,i.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-1rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border shadow-lg duration-200 max-h-[95vh] overflow-y-auto p-4 sm:p-6 sm:max-w-lg",s),...c,children:[a,n&&(0,t.jsxs)(l.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,t.jsx)(r.A,{}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function u(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"dialog-header",className:(0,i.cn)("flex flex-col gap-2 text-center sm:text-left",s),...a})}function x(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"dialog-footer",className:(0,i.cn)("flex flex-col gap-3 sm:flex-row sm:justify-end sm:gap-2 pt-4",s),...a})}function h(e){let{className:s,...a}=e;return(0,t.jsx)(l.hE,{"data-slot":"dialog-title",className:(0,i.cn)("text-lg leading-none font-semibold",s),...a})}function p(e){let{className:s,...a}=e;return(0,t.jsx)(l.VY,{"data-slot":"dialog-description",className:(0,i.cn)("text-muted-foreground text-sm",s),...a})}},4944:(e,s,a)=>{a.d(s,{k:()=>i});var t=a(5155);a(2115);var l=a(5863),r=a(9434);function i(e){let{className:s,value:a,...i}=e;return(0,t.jsx)(l.bL,{"data-slot":"progress",className:(0,r.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...i,children:(0,t.jsx)(l.C1,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})}},5057:(e,s,a)=>{a.d(s,{J:()=>i});var t=a(5155);a(2115);var l=a(968),r=a(9434);function i(e){let{className:s,...a}=e;return(0,t.jsx)(l.b,{"data-slot":"label",className:(0,r.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...a})}},5127:(e,s,a)=>{a.d(s,{A0:()=>i,BF:()=>n,Hj:()=>c,XI:()=>r,nA:()=>o,nd:()=>d});var t=a(5155);a(2115);var l=a(9434);function r(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,t.jsx)("table",{"data-slot":"table",className:(0,l.cn)("w-full caption-bottom text-sm",s),...a})})}function i(e){let{className:s,...a}=e;return(0,t.jsx)("thead",{"data-slot":"table-header",className:(0,l.cn)("[&_tr]:border-b",s),...a})}function n(e){let{className:s,...a}=e;return(0,t.jsx)("tbody",{"data-slot":"table-body",className:(0,l.cn)("[&_tr:last-child]:border-0",s),...a})}function c(e){let{className:s,...a}=e;return(0,t.jsx)("tr",{"data-slot":"table-row",className:(0,l.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",s),...a})}function d(e){let{className:s,...a}=e;return(0,t.jsx)("th",{"data-slot":"table-head",className:(0,l.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a})}function o(e){let{className:s,...a}=e;return(0,t.jsx)("td",{"data-slot":"table-cell",className:(0,l.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a})}},5232:(e,s,a)=>{a.d(s,{L:()=>p});var t=a(5155),l=a(2523),r=a(285),i=a(9409),n=a(7924),c=a(5213),d=a(5488),o=a(6932),m=a(5968),u=a(4653),x=a(9434);function h(e){let{viewMode:s,onViewModeChange:a,className:l}=e;return(0,t.jsxs)("div",{className:(0,x.cn)("flex rounded-md border",l),children:[(0,t.jsx)(r.$,{type:"button",variant:"list"===s?"default":"ghost",size:"icon",className:"rounded-r-none","aria-label":"Vue liste",onClick:()=>a("list"),children:(0,t.jsx)(m.A,{className:"h-4 w-4"})}),(0,t.jsx)(r.$,{type:"button",variant:"grid"===s?"default":"ghost",size:"icon",className:"rounded-l-none","aria-label":"Vue grille",onClick:()=>a("grid"),children:(0,t.jsx)(u.A,{className:"h-4 w-4"})})]})}function p(e){let{searchQuery:s,onSearchQueryChange:a,searchPlaceholder:m="Rechercher...",viewMode:u,onViewModeChange:p,sortField:f,sortOrder:j,sortOptions:g,onSortFieldChange:v,onSortOrderChange:N,onOpenFilters:b,showFilters:w=!0,className:y}=e;return(0,t.jsxs)("div",{className:(0,x.cn)("flex w-full flex-col gap-3 rounded-md border bg-background p-3 sm:flex-row sm:items-center",y),children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(n.A,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,t.jsx)(l.p,{value:s,onChange:e=>a(e.target.value),placeholder:m,className:"pl-9"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(i.l6,{value:f,onValueChange:e=>v(e),children:[(0,t.jsx)(i.bq,{className:"w-[180px]",children:(0,t.jsx)(i.yv,{placeholder:"Trier par"})}),(0,t.jsx)(i.gC,{children:g.map(e=>(0,t.jsx)(i.eb,{value:e.value,children:e.label},e.value))})]}),(0,t.jsx)(r.$,{type:"button",variant:"outline",size:"icon","aria-label":"asc"===j?"Ordre croissant":"Ordre d\xe9croissant",onClick:()=>N("asc"===j?"desc":"asc"),children:"asc"===j?(0,t.jsx)(c.A,{className:"h-4 w-4"}):(0,t.jsx)(d.A,{className:"h-4 w-4"})}),(0,t.jsx)(h,{viewMode:u,onViewModeChange:p}),w&&b&&(0,t.jsxs)(r.$,{type:"button",variant:"outline",onClick:b,children:[(0,t.jsx)(o.A,{className:"mr-2 h-4 w-4"}),"Filtres"]})]})]})}},5365:(e,s,a)=>{a.d(s,{Fc:()=>n,TN:()=>c});var t=a(5155);a(2115);var l=a(2085),r=a(9434);let i=(0,l.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function n(e){let{className:s,variant:a,...l}=e;return(0,t.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,r.cn)(i({variant:a}),s),...l})}function c(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"alert-description",className:(0,r.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...a})}},5391:(e,s,a)=>{a.d(s,{d:()=>j});var t=a(5155),l=a(2115),r=a(4165),i=a(285),n=a(2523),c=a(5057),d=a(8539),o=a(6126),m=a(4395),u=a(1380),x=a(5339),h=a(4229),p=a(5365),f=a(9409);function j(e){var s,a,j,g;let{document:v,isOpen:N,onClose:b,onSave:w}=e,[y,A]=(0,l.useState)({title:v.title,description:v.description||"",isPublic:v.isPublic,folderId:v.folderId||""}),[k,C]=(0,l.useState)(!1),[E,z]=(0,l.useState)(""),[S,P]=(0,l.useState)([]),[T,V]=(0,l.useState)(!1);(0,l.useEffect)(()=>{N&&I()},[N]),(0,l.useEffect)(()=>{A({title:v.title,description:v.description||"",isPublic:v.isPublic,folderId:v.folderId||"root"})},[v]);let I=async()=>{V(!0);try{let e=await fetch("/api/sidebar/folders",{credentials:"include"});if(e.ok){let s=await e.json();P(s.folders||[])}}catch(e){console.error("Erreur lors du chargement des dossiers:",e)}finally{V(!1)}},F=async e=>{e.preventDefault(),C(!0),z("");try{let e=await fetch("/api/documents/".concat(v.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:y.title,description:y.description,isPublic:y.isPublic,folderId:"root"===y.folderId?null:y.folderId})});if(e.ok){let a=await e.json();w(a.document||a);let t="root"===y.folderId?null:y.folderId;if(t!==v.folderId){var s;let e=t?null==(s=S.find(e=>e.id===t))?void 0:s.name:"la racine";console.log("Document d\xe9plac\xe9 vers : ".concat(e))}}else{let s=await e.json();z(s.error||"Erreur lors de la mise \xe0 jour")}}catch(e){z("Erreur de connexion")}finally{C(!1)}},L=(e,s)=>{A(a=>({...a,[e]:s}))};return(0,t.jsx)(r.lG,{open:N,onOpenChange:b,children:(0,t.jsxs)(r.Cf,{className:"w-full max-w-2xl mx-auto",children:[(0,t.jsx)(r.c7,{children:(0,t.jsx)(r.L3,{className:"text-lg sm:text-xl font-semibold",children:"Modifier le document"})}),(0,t.jsxs)("form",{onSubmit:F,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-gray-50 p-3 sm:p-4 rounded-lg space-y-2",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Fichier"}),(0,t.jsx)(o.E,{variant:"secondary",className:"w-fit",children:(null==(s=v.currentVersion)?void 0:s.fileType)||"Inconnu"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 break-all",children:(null==(a=v.currentVersion)?void 0:a.fileName)||"Sans nom"}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-0",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500",children:(e=>{if(0===e)return"0 Bytes";let s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]})((null==(j=v.currentVersion)?void 0:j.fileSize)||0)}),(0,t.jsx)("span",{className:"hidden sm:inline text-xs text-gray-500 mx-2",children:"•"}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["Version ",(null==(g=v.currentVersion)?void 0:g.versionNumber)||0]}),v.folder&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"hidden sm:inline text-xs text-gray-500 mx-2",children:"•"}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[(0,t.jsx)(m.A,{className:"h-3 w-3"}),v.folder.name]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c.J,{htmlFor:"title",children:"Titre *"}),(0,t.jsx)(n.p,{id:"title",value:y.title,onChange:e=>L("title",e.target.value),placeholder:"Titre du document",required:!0,disabled:k})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.J,{htmlFor:"description",children:"Description"}),(0,t.jsx)(d.T,{id:"description",value:y.description,onChange:e=>L("description",e.target.value),placeholder:"Description du document (optionnel)",rows:3,disabled:k})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(c.J,{htmlFor:"folderId",className:"flex items-center gap-2",children:[(0,t.jsx)(m.A,{className:"h-4 w-4"}),"Emplacement"]}),(0,t.jsxs)(f.l6,{value:y.folderId,onValueChange:e=>L("folderId",e),disabled:k||T,children:[(0,t.jsx)(f.bq,{className:"w-full",children:(0,t.jsx)(f.yv,{placeholder:T?"Chargement...":"S\xe9lectionner un dossier"})}),(0,t.jsxs)(f.gC,{children:[(0,t.jsx)(f.eb,{value:"root",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(u.A,{className:"h-4 w-4 text-gray-500"}),(0,t.jsx)("span",{children:"Racine (aucun dossier)"})]})}),S.map(e=>(0,t.jsx)(f.eb,{value:e.id,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(m.A,{className:"h-4 w-4 text-blue-500"}),(0,t.jsx)("span",{className:"truncate",children:e.name}),e.description&&(0,t.jsxs)("span",{className:"text-xs text-muted-foreground ml-auto",children:["(",e.description.slice(0,20),e.description.length>20?"...":"",")"]})]})},e.id))]})]}),"root"!==y.folderId&&v.folder&&y.folderId!==v.folderId&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Actuellement dans : ",v.folder.name]}),"root"===y.folderId&&v.folder&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Sera d\xe9plac\xe9 vers la racine depuis : ",v.folder.name]})]}),(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)("input",{type:"checkbox",id:"isPublic",checked:y.isPublic,onChange:e=>L("isPublic",e.target.checked),disabled:k,className:"mt-1 rounded border-gray-300"}),(0,t.jsx)(c.J,{htmlFor:"isPublic",className:"text-sm leading-relaxed",children:"Document public (visible par tous les utilisateurs)"})]})]}),E&&(0,t.jsxs)(p.Fc,{variant:"destructive",children:[(0,t.jsx)(x.A,{className:"h-4 w-4"}),(0,t.jsx)(p.TN,{children:E})]}),(0,t.jsxs)(r.Es,{className:"flex-col-reverse sm:flex-row",children:[(0,t.jsx)(i.$,{type:"button",variant:"outline",onClick:b,disabled:k,className:"w-full sm:w-auto",children:"Annuler"}),(0,t.jsx)(i.$,{type:"submit",disabled:k||!y.title.trim(),className:"w-full sm:w-auto",children:k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-gray-300 border-t-blue-600"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Enregistrement..."}),(0,t.jsx)("span",{className:"sm:hidden",children:"Envoi..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.A,{className:"mr-2 h-4 w-4"}),"Enregistrer"]})})]})]})]})})}},7944:(e,s,a)=>{a.d(s,{s:()=>i});var t=a(5155),l=a(5232);let r=[{value:"title",label:"Nom"},{value:"fileSize",label:"Taille"},{value:"createdAt",label:"Date d'ajout"},{value:"updatedAt",label:"Derni\xe8re mise \xe0 jour"},{value:"fileType",label:"Type"}];function i(e){let{searchQuery:s,onSearchQueryChange:a,viewMode:i,onViewModeChange:n,sortField:c,sortOrder:d,onSortFieldChange:o,onSortOrderChange:m,onOpenFilters:u,className:x}=e;return(0,t.jsx)(l.L,{searchQuery:s,onSearchQueryChange:a,searchPlaceholder:"Rechercher des fichiers...",viewMode:i,onViewModeChange:n,sortField:c,sortOrder:d,sortOptions:r,onSortFieldChange:o,onSortOrderChange:m,onOpenFilters:u,className:x})}},8539:(e,s,a)=>{a.d(s,{T:()=>r});var t=a(5155);a(2115);var l=a(9434);function r(e){let{className:s,...a}=e;return(0,t.jsx)("textarea",{"data-slot":"textarea",className:(0,l.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...a})}},9409:(e,s,a)=>{a.d(s,{bq:()=>m,eb:()=>x,gC:()=>u,l6:()=>d,yv:()=>o});var t=a(5155);a(2115);var l=a(83),r=a(6474),i=a(5196),n=a(7863),c=a(9434);function d(e){let{...s}=e;return(0,t.jsx)(l.bL,{"data-slot":"select",...s})}function o(e){let{...s}=e;return(0,t.jsx)(l.WT,{"data-slot":"select-value",...s})}function m(e){let{className:s,size:a="default",children:i,...n}=e;return(0,t.jsxs)(l.l9,{"data-slot":"select-trigger","data-size":a,className:(0,c.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...n,children:[i,(0,t.jsx)(l.In,{asChild:!0,children:(0,t.jsx)(r.A,{className:"size-4 opacity-50"})})]})}function u(e){let{className:s,children:a,position:r="popper",...i}=e;return(0,t.jsx)(l.ZL,{children:(0,t.jsxs)(l.UC,{"data-slot":"select-content",className:(0,c.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...i,children:[(0,t.jsx)(h,{}),(0,t.jsx)(l.LM,{className:(0,c.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),(0,t.jsx)(p,{})]})})}function x(e){let{className:s,children:a,...r}=e;return(0,t.jsxs)(l.q7,{"data-slot":"select-item",className:(0,c.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...r,children:[(0,t.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,t.jsx)(l.VF,{children:(0,t.jsx)(i.A,{className:"size-4"})})}),(0,t.jsx)(l.p4,{children:a})]})}function h(e){let{className:s,...a}=e;return(0,t.jsx)(l.PP,{"data-slot":"select-scroll-up-button",className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,t.jsx)(n.A,{className:"size-4"})})}function p(e){let{className:s,...a}=e;return(0,t.jsx)(l.wn,{"data-slot":"select-scroll-down-button",className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,t.jsx)(r.A,{className:"size-4"})})}}}]);