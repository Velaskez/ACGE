(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[512],{4944:(e,s,t)=>{"use strict";t.d(s,{k:()=>i});var a=t(5155);t(2115);var r=t(5863),l=t(9434);function i(e){let{className:s,value:t,...i}=e;return(0,a.jsx)(r.bL,{"data-slot":"progress",className:(0,l.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...i,children:(0,a.jsx)(r.C1,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:"translateX(-".concat(100-(t||0),"%)")}})})}},5057:(e,s,t)=>{"use strict";t.d(s,{J:()=>i});var a=t(5155);t(2115);var r=t(968),l=t(9434);function i(e){let{className:s,...t}=e;return(0,a.jsx)(r.b,{"data-slot":"label",className:(0,l.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...t})}},5327:(e,s,t)=>{"use strict";t.d(s,{n:()=>r});var a=t(2115);function r(){let[e,s]=(0,a.useState)([]),[t,r]=(0,a.useState)(!0),[l,i]=(0,a.useState)(null),n=async()=>{try{r(!0),i(null);let e=await fetch("/api/sidebar/folders",{credentials:"include"});if(e.ok){let t=await e.json();s(t.folders||[])}else if(401===e.status)s([]);else throw Error("Erreur ".concat(e.status))}catch(e){console.error("Erreur lors du chargement des dossiers:",e),i(e instanceof Error?e.message:"Erreur inconnue"),s([])}finally{r(!1)}};return(0,a.useEffect)(()=>{n()},[]),{folders:e,isLoading:t,error:l,refresh:()=>{n()}}}},5365:(e,s,t)=>{"use strict";t.d(s,{Fc:()=>n,TN:()=>c});var a=t(5155);t(2115);var r=t(2085),l=t(9434);let i=(0,r.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function n(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,l.cn)(i({variant:t}),s),...r})}function c(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"alert-description",className:(0,l.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...t})}},5392:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>_});var a=t(5155),r=t(2115),l=t(5695),i=t(4379),n=t(1046),c=t(285),d=t(6695),o=t(4944),u=t(5365),x=t(7213),m=t(7434),p=t(9890),h=t(9869),g=t(5339),f=t(5196),j=t(1154),v=t(4416);function b(e){let{onUpload:s,maxFiles:t=10,maxSize:l=50,acceptedTypes:i=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","image/*","text/*"],className:b=""}=e,[N,y]=(0,r.useState)([]),[w,A]=(0,r.useState)(!1),[k,z]=(0,r.useState)(""),S=(0,r.useCallback)((e,s)=>{z(""),s.length>0&&z(s.map(e=>{let{file:s,errors:a}=e;return a.map(e=>{switch(e.code){case"file-too-large":return"".concat(s.name," est trop volumineux (max: ").concat(l,"MB)");case"file-invalid-type":return"".concat(s.name," n'est pas un type de fichier autoris\xe9");case"too-many-files":return"Trop de fichiers (max: ".concat(t,")");default:return"".concat(s.name,": ").concat(e.message)}}).join(", ")}).join("; "));let a=e.map(e=>Object.assign(e,{preview:e.type.startsWith("image/")?URL.createObjectURL(e):void 0,uploadProgress:0,uploadStatus:"pending"}));y(e=>[...e,...a])},[t,l]),{getRootProps:C,getInputProps:E,isDragActive:T}=(0,n.VB)({onDrop:S,accept:i.reduce((e,s)=>(e[s]=[],e),{}),maxFiles:t,maxSize:1024*l*1024,multiple:!0}),_=async()=>{if(0!==N.length&&s){A(!0),z("");try{await s(N),y(e=>e.map(e=>({...e,uploadStatus:"success",uploadProgress:100}))),setTimeout(()=>{y([])},2e3)}catch(e){z("Erreur lors de l'upload des fichiers"),y(e=>e.map(e=>({...e,uploadStatus:"error",errorMessage:"Upload \xe9chou\xe9"})))}finally{A(!1)}}};return(0,a.jsxs)("div",{className:"space-y-4 ".concat(b),children:[(0,a.jsx)(d.Zp,{className:"border-2 border-dashed transition-colors ".concat(T?"border-blue-500 bg-blue-50 dark:bg-blue-950/20":"border-gray-300 hover:border-gray-400"),children:(0,a.jsx)(d.Wu,{className:"p-8",children:(0,a.jsxs)("div",{...C(),className:"text-center cursor-pointer",children:[(0,a.jsx)("input",{...E()}),(0,a.jsx)(h.A,{className:"mx-auto h-12 w-12 mb-4 ".concat(T?"text-blue-500":"text-gray-400")}),T?(0,a.jsx)("p",{className:"text-lg font-medium text-blue-600",children:"D\xe9posez les fichiers ici..."}):(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Glissez-d\xe9posez vos fichiers ici"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"ou cliquez pour s\xe9lectionner des fichiers"}),(0,a.jsx)(c.$,{variant:"outline",children:"Parcourir les fichiers"})]}),(0,a.jsxs)("div",{className:"mt-4 text-xs text-gray-500",children:[(0,a.jsx)("p",{children:"Formats accept\xe9s : PDF, Word, Excel, Images, Texte"}),(0,a.jsxs)("p",{children:["Taille maximale : ",l,"MB par fichier â€¢ Maximum ",t," fichiers"]})]})]})})}),k&&(0,a.jsxs)(u.Fc,{variant:"destructive",children:[(0,a.jsx)(g.A,{className:"h-4 w-4"}),(0,a.jsx)(u.TN,{children:k})]}),N.length>0&&(0,a.jsx)(d.Zp,{children:(0,a.jsxs)(d.Wu,{className:"p-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h3",{className:"font-medium text-lg",children:["Fichiers s\xe9lectionn\xe9s (",N.length,")"]}),N.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:e.preview?(0,a.jsx)("img",{src:e.preview,alt:e.name,className:"w-10 h-10 object-cover rounded"}):e.type.startsWith("image/")?(0,a.jsx)(x.A,{className:"w-5 h-5 text-blue-500"}):e.type.includes("pdf")?(0,a.jsx)(m.A,{className:"w-5 h-5 text-red-500"}):e.type.includes("word")||e.type.includes("document")?(0,a.jsx)(m.A,{className:"w-5 h-5 text-blue-600"}):e.type.includes("excel")||e.type.includes("sheet")?(0,a.jsx)(m.A,{className:"w-5 h-5 text-green-600"}):(0,a.jsx)(p.A,{className:"w-5 h-5 text-gray-500"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:e.name}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:(e=>{if(0===e)return"0 Bytes";let s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]})(e.size)}),"uploading"===e.uploadStatus&&(0,a.jsx)(o.k,{value:e.uploadProgress||0,className:"mt-2 h-2"}),"error"===e.uploadStatus&&e.errorMessage&&(0,a.jsx)("p",{className:"text-xs text-red-500 mt-1",children:e.errorMessage})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["success"===e.uploadStatus&&(0,a.jsx)(f.A,{className:"w-5 h-5 text-green-500"}),"error"===e.uploadStatus&&(0,a.jsx)(g.A,{className:"w-5 h-5 text-red-500"}),"uploading"===e.uploadStatus&&(0,a.jsx)(j.A,{className:"w-5 h-5 text-blue-500 animate-spin"}),"pending"===e.uploadStatus&&(0,a.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>{y(e=>{let t=[...e];return t[s].preview&&URL.revokeObjectURL(t[s].preview),t.splice(s,1),t})},className:"h-8 w-8 p-0",children:(0,a.jsx)(v.A,{className:"w-4 h-4"})})]})]},s))]}),N.some(e=>"pending"===e.uploadStatus)&&(0,a.jsx)("div",{className:"mt-4 flex justify-end",children:(0,a.jsx)(c.$,{onClick:_,disabled:w,className:"min-w-32",children:w?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Upload en cours..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4"}),"Uploader ",N.filter(e=>"pending"===e.uploadStatus).length," fichier(s)"]})})})]})})]})}var N=t(2523),y=t(5057),w=t(8539),A=t(6126),k=t(5327),z=t(9409),S=t(5169),C=t(1284),E=t(3332),T=t(4395);function _(){let e=(0,l.useRouter)(),{folders:s,isLoading:t}=(0,k.n)(),[n,o]=(0,r.useState)({name:"",description:"",tags:[],category:"document"}),[x,m]=(0,r.useState)(""),[p,g]=(0,r.useState)(!1),[j,v]=(0,r.useState)(""),_=async s=>{v("");try{let t=new FormData;s.forEach((e,s)=>{t.append("files",e)}),t.append("metadata",JSON.stringify({...n,fileCount:s.length}));let a=await fetch("/api/upload",{method:"POST",body:t}),r=await a.text(),l={};try{l=r?JSON.parse(r):{}}catch(e){}if(!a.ok){let e=(null==l?void 0:l.error)||"Erreur lors de l'upload",s=Array.isArray(null==l?void 0:l.errors)&&l.errors.length?" (".concat(l.errors.length," fichier(s) en erreur)"):"";throw Error("".concat(e).concat(s))}Array.isArray(null==l?void 0:l.errors)&&l.errors.length&&v("Upload partiel: ".concat(l.errors.length," \xe9chec(s).")),g(!0),setTimeout(()=>{e.push("/documents")},2e3)}catch(e){console.error("Erreur upload:",e),v(e instanceof Error?e.message:"Erreur inconnue")}},B=()=>{x.trim()&&!n.tags.includes(x.trim())&&(o(e=>({...e,tags:[...e.tags,x.trim()]})),m(""))};return p?(0,a.jsx)(i.O,{children:(0,a.jsx)("div",{className:"max-w-2xl mx-auto py-12",children:(0,a.jsx)(d.Zp,{className:"text-center",children:(0,a.jsxs)(d.Wu,{className:"pt-6",children:[(0,a.jsx)("div",{className:"mx-auto w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mb-4",children:(0,a.jsx)(f.A,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-green-600 dark:text-green-400 mb-2",children:"Upload r\xe9ussi !"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Vos fichiers ont \xe9t\xe9 upload\xe9s avec succ\xe8s."}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Redirection vers la liste des documents..."})]})})})}):(0,a.jsx)(i.O,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(c.$,{variant:"ghost",size:"icon",onClick:()=>e.back(),children:(0,a.jsx)(S.A,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[(0,a.jsx)(h.A,{className:"w-8 h-8"}),"Upload de Fichiers"]}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Ajoutez de nouveaux fichiers \xe0 l'application"})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{children:[(0,a.jsx)(d.ZB,{children:"S\xe9lection des fichiers"}),(0,a.jsx)(d.BT,{children:"Glissez-d\xe9posez vos fichiers ou cliquez pour les s\xe9lectionner"})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsx)(b,{onUpload:_})})]})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{children:[(0,a.jsxs)(d.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(C.A,{className:"w-5 h-5"}),"M\xe9tadonn\xe9es"]}),(0,a.jsx)(d.BT,{children:"Informations qui seront appliqu\xe9es \xe0 tous les fichiers"})]}),(0,a.jsxs)(d.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(y.J,{htmlFor:"category",children:"Cat\xe9gorie"}),(0,a.jsxs)(z.l6,{value:n.category,onValueChange:e=>o(s=>({...s,category:e})),children:[(0,a.jsx)(z.bq,{children:(0,a.jsx)(z.yv,{})}),(0,a.jsx)(z.gC,{children:[{value:"document",label:"Document"},{value:"image",label:"Image"},{value:"video",label:"Vid\xe9o"},{value:"audio",label:"Audio"},{value:"archive",label:"Archive"},{value:"other",label:"Autre"}].map(e=>(0,a.jsx)(z.eb,{value:e.value,children:e.label},e.value))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(y.J,{htmlFor:"description",children:"Description"}),(0,a.jsx)(w.T,{id:"description",placeholder:"Description des documents...",value:n.description,onChange:e=>o(s=>({...s,description:e.target.value})),rows:3})]})]})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{children:[(0,a.jsxs)(d.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(E.A,{className:"w-5 h-5"}),"Tags"]}),(0,a.jsx)(d.BT,{children:"Ajoutez des tags pour faciliter la recherche"})]}),(0,a.jsxs)(d.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(N.p,{placeholder:"Ajouter un tag...",value:x,onChange:e=>m(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),B())}}),(0,a.jsx)(c.$,{onClick:B,size:"sm",children:"Ajouter"})]}),n.tags.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:n.tags.map(e=>(0,a.jsxs)(A.E,{variant:"secondary",className:"cursor-pointer",onClick:()=>{o(s=>({...s,tags:s.tags.filter(s=>s!==e)}))},children:[e," \xd7"]},e))})]})]}),(0,a.jsxs)(d.Zp,{children:[(0,a.jsxs)(d.aR,{children:[(0,a.jsxs)(d.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(T.A,{className:"w-5 h-5"}),"Dossier"]}),(0,a.jsx)(d.BT,{children:"S\xe9lectionnez le dossier de destination"})]}),(0,a.jsx)(d.Wu,{children:(0,a.jsxs)(z.l6,{value:n.folderId||"root",onValueChange:e=>o(s=>({...s,folderId:"root"===e?void 0:e})),children:[(0,a.jsx)(z.bq,{children:(0,a.jsx)(z.yv,{placeholder:"Racine (aucun dossier)"})}),(0,a.jsxs)(z.gC,{children:[(0,a.jsx)(z.eb,{value:"root",children:"Racine (aucun dossier)"}),t?(0,a.jsx)(z.eb,{value:"loading",disabled:!0,children:"Chargement..."}):s.map(e=>(0,a.jsxs)(z.eb,{value:e.id,children:[e.name,void 0!==e.documentCount&&" (".concat(e.documentCount,")")]},e.id))]})]})})]})]})]}),j&&(0,a.jsx)(u.Fc,{variant:"destructive",children:(0,a.jsx)(u.TN,{children:j})})]})})}},5410:(e,s,t)=>{Promise.resolve().then(t.bind(t,5392))},8539:(e,s,t)=>{"use strict";t.d(s,{T:()=>l});var a=t(5155);t(2115);var r=t(9434);function l(e){let{className:s,...t}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,r.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...t})}},9409:(e,s,t)=>{"use strict";t.d(s,{bq:()=>u,eb:()=>m,gC:()=>x,l6:()=>d,yv:()=>o});var a=t(5155);t(2115);var r=t(83),l=t(6474),i=t(5196),n=t(7863),c=t(9434);function d(e){let{...s}=e;return(0,a.jsx)(r.bL,{"data-slot":"select",...s})}function o(e){let{...s}=e;return(0,a.jsx)(r.WT,{"data-slot":"select-value",...s})}function u(e){let{className:s,size:t="default",children:i,...n}=e;return(0,a.jsxs)(r.l9,{"data-slot":"select-trigger","data-size":t,className:(0,c.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...n,children:[i,(0,a.jsx)(r.In,{asChild:!0,children:(0,a.jsx)(l.A,{className:"size-4 opacity-50"})})]})}function x(e){let{className:s,children:t,position:l="popper",...i}=e;return(0,a.jsx)(r.ZL,{children:(0,a.jsxs)(r.UC,{"data-slot":"select-content",className:(0,c.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:l,...i,children:[(0,a.jsx)(p,{}),(0,a.jsx)(r.LM,{className:(0,c.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),(0,a.jsx)(h,{})]})})}function m(e){let{className:s,children:t,...l}=e;return(0,a.jsxs)(r.q7,{"data-slot":"select-item",className:(0,c.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...l,children:[(0,a.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,a.jsx)(r.VF,{children:(0,a.jsx)(i.A,{className:"size-4"})})}),(0,a.jsx)(r.p4,{children:t})]})}function p(e){let{className:s,...t}=e;return(0,a.jsx)(r.PP,{"data-slot":"select-scroll-up-button",className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...t,children:(0,a.jsx)(n.A,{className:"size-4"})})}function h(e){let{className:s,...t}=e;return(0,a.jsx)(r.wn,{"data-slot":"select-scroll-down-button",className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...t,children:(0,a.jsx)(l.A,{className:"size-4"})})}}},e=>{e.O(0,[785,882,412,351,209,441,964,358],()=>e(e.s=5410)),_N_E=e.O()}]);