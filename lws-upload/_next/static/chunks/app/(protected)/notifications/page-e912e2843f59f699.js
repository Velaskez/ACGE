(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[463],{2657:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},3237:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w});var s=a(5155),i=a(2115),r=a(4379),n=a(6695),l=a(285),c=a(6126),d=a(5365),o=a(9434),u=a(6516),m=a(7434),x=a(133),h=a(1007),g=a(381),f=a(5339),p=a(3861),v=a(437),j=a(1154),N=a(8749),y=a(2657);function w(){let[e,t]=(0,i.useState)([]),[a,w]=(0,i.useState)(!0),[E,b]=(0,i.useState)(""),[S,k]=(0,i.useState)("all"),[A,R]=(0,i.useState)({page:1,limit:20,total:0,totalPages:0});(0,i.useEffect)(()=>{C()},[S,A.page]);let C=async()=>{try{w(!0),b("");let e=new URLSearchParams({page:A.page.toString(),limit:A.limit.toString(),..."unread"===S&&{unreadOnly:"true"}}),a=await fetch("/api/notifications?".concat(e));if(a.ok){let e=await a.json();t(e.notifications||[]),R(t=>{var a,s;return{...t,total:(null==(a=e.pagination)?void 0:a.total)||0,totalPages:(null==(s=e.pagination)?void 0:s.totalPages)||0}})}else b("Erreur lors du chargement des notifications")}catch(e){b("Erreur de connexion")}finally{w(!1)}},O=async e=>{try{(await fetch("/api/notifications/".concat(e,"/read"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isRead:!0})})).ok&&t(t=>t.map(t=>t.id===e?{...t,isRead:!0}:t))}catch(e){console.error("Erreur lors du marquage:",e)}},P=async e=>{try{(await fetch("/api/notifications/".concat(e,"/read"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isRead:!1})})).ok&&t(t=>t.map(t=>t.id===e?{...t,isRead:!1}:t))}catch(e){console.error("Erreur lors du marquage:",e)}},T=async()=>{try{(await fetch("/api/notifications/mark-all-read",{method:"PUT"})).ok&&t(e=>e.map(e=>({...e,isRead:!0})))}catch(e){console.error("Erreur lors du marquage global:",e)}},_=e.filter(e=>!e.isRead).length;return(0,s.jsx)(r.O,{title:"Notifications",description:"Consultez vos notifications et restez inform\xe9 des derni\xe8res activit\xe9s",icon:p.A,children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,s.jsx)("div",{className:"flex items-center gap-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(l.$,{variant:"all"===S?"default":"outline",size:"sm",onClick:()=>{k("all"),R(e=>({...e,page:1}))},children:["Toutes (",A.total,")"]}),(0,s.jsxs)(l.$,{variant:"unread"===S?"default":"outline",size:"sm",onClick:()=>{k("unread"),R(e=>({...e,page:1}))},children:["Non lues (",_,")"]})]})}),_>0&&(0,s.jsxs)(l.$,{onClick:T,size:"sm",className:"self-start",children:[(0,s.jsx)(v.A,{className:"mr-2 h-4 w-4"}),"Marquer tout comme lu"]})]}),E&&(0,s.jsxs)(d.Fc,{variant:"destructive",children:[(0,s.jsx)(f.A,{className:"h-4 w-4"}),(0,s.jsx)(d.TN,{children:E})]}),a?(0,s.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,s.jsx)(j.A,{className:"h-8 w-8 animate-spin"}),(0,s.jsx)("span",{className:"ml-2",children:"Chargement des notifications..."})]}):0===e.length?(0,s.jsx)(n.Zp,{children:(0,s.jsxs)(n.Wu,{className:"flex flex-col items-center justify-center py-12",children:[(0,s.jsx)(p.A,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium mb-2",children:"unread"===S?"Aucune notification non lue":"Aucune notification"}),(0,s.jsx)("p",{className:"text-muted-foreground text-center",children:"unread"===S?"Toutes vos notifications ont \xe9t\xe9 lues !":"Vous n'avez pas encore de notifications."})]})}):(0,s.jsx)("div",{className:"space-y-3",children:e.map(e=>(0,s.jsx)(n.Zp,{className:"cursor-pointer transition-all hover:shadow-md ".concat(e.isRead?"":"border-l-4 border-l-blue-500 bg-blue-50/30"),onClick:()=>{var t;e.isRead||O(e.id),(null==(t=e.data)?void 0:t.documentId)&&(window.location.href="/documents?view=".concat(e.data.documentId))},children:(0,s.jsx)(n.Wu,{className:"p-4",children:(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mt-1",children:(e=>{switch(e){case"DOCUMENT_SHARED":return(0,s.jsx)(u.A,{className:"h-5 w-5 text-blue-500"});case"VERSION_ADDED":return(0,s.jsx)(m.A,{className:"h-5 w-5 text-green-500"});case"VERSION_RESTORED":return(0,s.jsx)(x.A,{className:"h-5 w-5 text-orange-500"});case"WELCOME":return(0,s.jsx)(h.A,{className:"h-5 w-5 text-purple-500"});case"SYSTEM":return(0,s.jsx)(g.A,{className:"h-5 w-5 text-gray-500"});default:return(0,s.jsx)(f.A,{className:"h-5 w-5 text-gray-500"})}})(e.type)}),(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("h3",{className:"font-medium ".concat(e.isRead?"text-gray-700":"text-gray-900"),children:e.title}),(0,s.jsx)(c.E,{variant:"outline",className:"text-xs",children:(e=>{switch(e){case"DOCUMENT_SHARED":return"Partage";case"VERSION_ADDED":return"Nouvelle version";case"VERSION_RESTORED":return"Version restaur\xe9e";case"WELCOME":return"Bienvenue";case"SYSTEM":return"Syst\xe8me";default:return"Notification"}})(e.type)}),!e.isRead&&(0,s.jsx)(c.E,{variant:"destructive",className:"text-xs",children:"Nouveau"})]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:e.message}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,o.fw)(e.createdAt.toString())})]}),(0,s.jsx)("div",{className:"flex items-center gap-1",children:e.isRead?(0,s.jsx)(l.$,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),P(e.id)},children:(0,s.jsx)(N.A,{className:"h-4 w-4"})}):(0,s.jsx)(l.$,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),O(e.id)},children:(0,s.jsx)(y.A,{className:"h-4 w-4"})})})]})})]})})},e.id))}),A.totalPages>1&&(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Page ",A.page," sur ",A.totalPages]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(l.$,{variant:"outline",size:"sm",disabled:1===A.page,onClick:()=>R(e=>({...e,page:e.page-1})),children:"Pr\xe9c\xe9dent"}),(0,s.jsx)(l.$,{variant:"outline",size:"sm",disabled:A.page===A.totalPages,onClick:()=>R(e=>({...e,page:e.page+1})),children:"Suivant"})]})]})]})})}},5365:(e,t,a)=>{"use strict";a.d(t,{Fc:()=>l,TN:()=>c});var s=a(5155);a(2115);var i=a(2085),r=a(9434);let n=(0,i.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:a,...i}=e;return(0,s.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,r.cn)(n({variant:a}),t),...i})}function c(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-description",className:(0,r.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...a})}},5367:(e,t,a)=>{Promise.resolve().then(a.bind(a,3237))},8749:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]])}},e=>{e.O(0,[785,882,209,441,964,358],()=>e(e.s=5367)),_N_E=e.O()}]);